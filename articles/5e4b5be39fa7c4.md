---
title: "go-swaggerã®ã€swagger generateã€‘ã§ãƒãƒã£ãŸæ³¨æ„ç‚¹ "
emoji: "âš "
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Swagger", "Go", "OpenAPI"]
published: true
---

## çµŒç·¯
æ¥­å‹™ã§[go-swagger](https://goswagger.io/)ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã¨ãªã‚Šã€Swaggerãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†å‰²ã—ã¦ã„ãã¨æ–¹é‡ãŒæ±ºã¾ã‚Šã¾ã—ãŸã€‚
åˆ†å‰²ã™ã‚‹ã«å½“ãŸã‚ŠSwaggerã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã—ãŸã€‚
```
â”œâ”€swagger
â”‚   â”œâ”€â”€ã‚µãƒ–ã‚·ã‚¹ãƒ†ãƒ 
â”‚   â”‚  â””â”€â”€â”€æ¥­å‹™
â”‚   â”‚        â””â”€â”€â”€ç”»é¢
â”‚   â”‚              â”œâ”€â”€â”€paths.yaml(apiå®šç¾©)
â”‚   â”‚              â”œâ”€â”€â”€paths.yaml(apiå®šç¾©)
â”‚   â”‚              â””â”€â”€â”€definitions.yaml(modelså®šç¾©)
â”‚   â”‚
â”‚   â”œâ”€â”€swagger.yaml
```
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ç”»é¢ã”ã¨ã«apiã‚’å‘¼ã³å‡ºã™ãŸã‚ã€ä¸Šè¨˜ã®ã‚ˆã†ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã§ç®¡ç†ã—ã¦ã„ã“ã†ã¨ãªã‚Šã¾ã—ãŸã€‚
å„ç”»é¢ã”ã¨ã®apiå®šç¾©ã¨modelså®šç¾©ã‚’swagger.yamlã§å‘¼ã³è¾¼ã¿ã¾ã™ã€‚

## ãƒãƒã£ãŸç‚¹
```type: array```ã‚’```$ref```ã§å‘¼ã³å‡ºã™
Petã¨ã„ã†modelã‚’å®šç¾©ã—ã€é…åˆ—ã§å‘¼ã³è¾¼ã‚‚ã†ã¨ã—ãŸå ´åˆ
```yaml:definitions.yaml
Pet:
  type: "object"
  properties:
    id:
      type: "integer"
      format: "int64"
    name:
      type: "string"
      example: "doggie"
```
```yaml:pet.yaml
responses:
  200:
    description: "successful operation"
    schema:
      type: "array"
      items:
        $ref: "./definitions.yaml#/Pet"
```
```yaml:swagger.yaml
paths:
  /pet:
    $ref: ./sub_system/business/screen/pet.yaml
definitions:
  Pet:
    $ref: "./sub_system/business/screen/definitions.yaml#/Pet"
```

ã—ã‹ã—ä¸Šè¨˜ã®æ§‹æˆã§```swagger generate server -t gen -f ./swagger/swagger.yaml```ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€‚ã€‚ã€‚
```terminal
$ swagger generate server -t gen -f ./swagger/swagger.yaml
2022/02/05 02:41:15 validating spec /home/ubuntu/go/src/custom-server/swagger/swagger.yaml
2022/02/05 02:41:15 preprocessing spec with option:  minimal flattening
could not resolve schema: open /home/ubuntu/go/src/custom-server/swagger/definitions.yaml: no such file or directory
```
ä¸Šè¨˜ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šgenerateã«å¤±æ•—ã—ã¾ã™ğŸ™ƒ
åŸå› ã¯ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚ã€‚
SwaggerViewerã§ç¢ºèªã—ã¦ã‚‚å•é¡Œãªã„ã—ã€Swagger Editorã«ã‚‚è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹æ›¸ãæ–¹ã¨ã»ã¼åŒã˜ãªã®ã«ã€‚ã€‚

## å¯¾å¿œç­–
arrayã®modelã‚’ä½œæˆã—ã¦ãã‚Œã‚’å‘¼ã³è¾¼ã‚€
```diff yaml:definitions.yaml
+  PetList:
+    type: "array"
+    items:
+      $ref: "#/Pet"
Pet:
  type: "object"
  properties:
    id:
      type: "integer"
      format: "int64"
    name:
      type: "string"
      example: "doggie"
```
```diff yaml:pet.yaml
responses:
  200:
    description: "successful operation"
    schema:
-      type: "array"
-      items:
-        $ref: "./definitions.yaml#/Pet"
+      $ref: "./definitions.yaml#/PetList"
```
```diff yaml:swagger.yaml
paths:
  /pet:
    $ref: ./sub_system/business/screen/pet.yaml
definitions:
  Pet:
    $ref: "./sub_system/business/screen/definitions.yaml#/Pet"
  PetList:
+    $ref: "./sub_system/business/screen/definitions.yaml#/PetList"
```

ä¸Šè¨˜ã ã¨generateã«æˆåŠŸã—ã¾ã™ğŸ‘

## èª²é¡Œ
åˆ†å‰²ã—ã¦ã„ã‚‹ã¨```swagger generate```ã§ãã¦ã‚‚```swagger validate```ã§WARNINGãŒå‡ºç¾ã™ã‚‹ğŸ˜‡
```terminal
$ swagger validate ./swagger/swagger.yaml
2022/02/05 03:02:41
The swagger spec at "./swagger/swagger.yaml" is valid against swagger specification 2.0
2022/02/05 03:02:41
The swagger spec at "./swagger/swagger.yaml" showed up some valid but possibly unwanted constructs.
2022/02/05 03:02:41 See warnings below:
2022/02/05 03:02:41 - WARNING: definition "#/definitions/PetList" is not used anywhere
2022/02/05 03:02:41 - WARNING: definition "#/definitions/Pet" is not used anywhere
```